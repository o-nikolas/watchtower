
<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
  
  <!-- Licensed under the Apache 2.0 License -->
  <link rel="stylesheet" type="text/css" href="_static/fonts/open-sans/stylesheet.css" />
  <!-- Licensed under the SIL Open Font License -->
  <link rel="stylesheet" type="text/css" href="_static/fonts/source-serif-pro/source-serif-pro.css" />
  <link rel="stylesheet" type="text/css" href="_static/css/bootstrap.min.css" />
  <link rel="stylesheet" type="text/css" href="_static/css/bootstrap-theme.min.css" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
    <title>Watchtower: Python CloudWatch Logging &#8212; watchtower  documentation</title>
    <link rel="stylesheet" href="_static/guzzle.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <script type="text/javascript" src="_static/language_data.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
  
   

  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="#">watchtower  documentation</a> &#187;</li> 
      </ul>
    </div>
    <div class="container-wrapper">

      <div id="mobile-toggle">
        <a href="#"><span class="glyphicon glyphicon-align-justify" aria-hidden="true"></span></a>
      </div>
  <div id="left-column">
    <div class="sphinxsidebar"><a href="
    #" class="text-logo">watchtower</a>
<div class="sidebar-block">
  <div class="sidebar-wrapper">
    <h2>Contents</h2>
    <div class="sidebar-localtoc">
      <ul>
<li><a class="reference internal" href="#">Watchtower: Python CloudWatch Logging</a><ul>
<li><a class="reference internal" href="#installation">Installation</a></li>
<li><a class="reference internal" href="#synopsis">Synopsis</a></li>
<li><a class="reference internal" href="#example-flask-logging-with-watchtower">Example: Flask logging with Watchtower</a></li>
<li><a class="reference internal" href="#example-django-logging-with-watchtower">Example: Django logging with Watchtower</a></li>
<li><a class="reference internal" href="#examples-querying-cloudwatch-logs">Examples: Querying CloudWatch logs</a></li>
<li><a class="reference internal" href="#examples-python-logging-config">Examples: Python Logging Config</a><ul>
<li><a class="reference internal" href="#authors">Authors</a></li>
<li><a class="reference internal" href="#links">Links</a></li>
</ul>
</li>
<li><a class="reference internal" href="#bugs">Bugs</a><ul>
<li><a class="reference internal" href="#license">License</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#module-watchtower">API documentation</a></li>
<li><a class="reference internal" href="#table-of-contents">Table of Contents</a></li>
</ul>

    </div>
  </div>
</div>
<div class="sidebar-block">
  <div class="sidebar-wrapper">
    <div id="main-search">
      <form class="form-inline" action="search.html" method="GET" role="form">
        <div class="input-group">
          <input name="q" type="text" class="form-control" placeholder="Search...">
        </div>
        <input type="hidden" name="check_keywords" value="yes" />
        <input type="hidden" name="area" value="default" />
      </form>
    </div>
  </div>
</div>
      
    </div>
  </div>
        <div id="right-column">
          
          <div role="navigation" aria-label="breadcrumbs navigation">
            <ol class="breadcrumb">
              <li><a href="#">Docs</a></li>
              
              <li>Watchtower: Python CloudWatch Logging</li>
            </ol>
          </div>
          
          <div class="document clearer body">
            
  <div class="section" id="watchtower-python-cloudwatch-logging">
<h1>Watchtower: Python CloudWatch Logging<a class="headerlink" href="#watchtower-python-cloudwatch-logging" title="Permalink to this headline">¶</a></h1>
<p>Watchtower is a log handler for <a class="reference external" href="https://aws.amazon.com/blogs/aws/cloudwatch-log-service/">Amazon Web Services CloudWatch Logs</a>.</p>
<p>CloudWatch Logs is a log management service built into AWS. It is conceptually similar to services like Splunk and
Loggly, but is more lightweight, cheaper, and tightly integrated with the rest of AWS.</p>
<p>Watchtower, in turn, is a lightweight adapter between the <a class="reference external" href="https://docs.python.org/library/logging.html">Python logging system</a> and CloudWatch Logs. It uses the <a class="reference external" href="https://github.com/boto/boto3">boto3 AWS SDK</a>, and lets you plug your application logging directly into CloudWatch without the need
to install a system-wide log collector like <a class="reference external" href="https://pypi.python.org/pypi/awscli-cwlogs">awscli-cwlogs</a> and round-trip
your logs through the instance’s syslog. It aggregates logs into batches to avoid sending an API request per each log
message, while guaranteeing a delivery deadline (60 seconds by default).</p>
<div class="section" id="installation">
<h2>Installation<a class="headerlink" href="#installation" title="Permalink to this headline">¶</a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">pip</span> <span class="n">install</span> <span class="n">watchtower</span>
</pre></div>
</div>
</div>
<div class="section" id="synopsis">
<h2>Synopsis<a class="headerlink" href="#synopsis" title="Permalink to this headline">¶</a></h2>
<p>Install <a class="reference external" href="https://pypi.python.org/pypi/awscli">awscli</a> and set your AWS credentials (run <code class="docutils literal notranslate"><span class="pre">aws</span> <span class="pre">configure</span></code>).</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">watchtower</span><span class="o">,</span> <span class="nn">logging</span>
<span class="n">logging</span><span class="o">.</span><span class="n">basicConfig</span><span class="p">(</span><span class="n">level</span><span class="o">=</span><span class="n">logging</span><span class="o">.</span><span class="n">INFO</span><span class="p">)</span>
<span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>
<span class="n">logger</span><span class="o">.</span><span class="n">addHandler</span><span class="p">(</span><span class="n">watchtower</span><span class="o">.</span><span class="n">CloudWatchLogHandler</span><span class="p">())</span>
<span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Hi&quot;</span><span class="p">)</span>
<span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="nb">dict</span><span class="p">(</span><span class="n">foo</span><span class="o">=</span><span class="s2">&quot;bar&quot;</span><span class="p">,</span> <span class="n">details</span><span class="o">=</span><span class="p">{}))</span>
</pre></div>
</div>
<p>After running the example, you can see the log output in your <a class="reference external" href="https://console.aws.amazon.com/cloudwatch/home">AWS console</a>.</p>
</div>
<div class="section" id="example-flask-logging-with-watchtower">
<h2>Example: Flask logging with Watchtower<a class="headerlink" href="#example-flask-logging-with-watchtower" title="Permalink to this headline">¶</a></h2>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">watchtower</span><span class="o">,</span> <span class="nn">flask</span><span class="o">,</span> <span class="nn">logging</span>

<span class="n">logging</span><span class="o">.</span><span class="n">basicConfig</span><span class="p">(</span><span class="n">level</span><span class="o">=</span><span class="n">logging</span><span class="o">.</span><span class="n">INFO</span><span class="p">)</span>
<span class="n">app</span> <span class="o">=</span> <span class="n">flask</span><span class="o">.</span><span class="n">Flask</span><span class="p">(</span><span class="s2">&quot;loggable&quot;</span><span class="p">)</span>
<span class="n">handler</span> <span class="o">=</span> <span class="n">watchtower</span><span class="o">.</span><span class="n">CloudWatchLogHandler</span><span class="p">()</span>
<span class="n">app</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">addHandler</span><span class="p">(</span><span class="n">handler</span><span class="p">)</span>
<span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="s2">&quot;werkzeug&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">addHandler</span><span class="p">(</span><span class="n">handler</span><span class="p">)</span>

<span class="nd">@app.route</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">hello_world</span><span class="p">():</span>
    <span class="k">return</span> <span class="s1">&#39;Hello World!&#39;</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">app</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
</pre></div>
</div>
<p>(See also <a class="reference external" href="http://flask.pocoo.org/docs/errorhandling/">http://flask.pocoo.org/docs/errorhandling/</a>.)</p>
</div>
<div class="section" id="example-django-logging-with-watchtower">
<h2>Example: Django logging with Watchtower<a class="headerlink" href="#example-django-logging-with-watchtower" title="Permalink to this headline">¶</a></h2>
<p>This is an example of Watchtower integration with Django. In your Django project, add the following to <code class="docutils literal notranslate"><span class="pre">settings.py</span></code>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">boto3.session</span> <span class="kn">import</span> <span class="n">Session</span>

<span class="n">AWS_ACCESS_KEY_ID</span> <span class="o">=</span> <span class="s1">&#39;your access key&#39;</span>
<span class="n">AWS_SECRET_ACCESS_KEY</span> <span class="o">=</span> <span class="s1">&#39;your secret access key&#39;</span>
<span class="n">AWS_REGION_NAME</span> <span class="o">=</span> <span class="s1">&#39;your region&#39;</span>

<span class="n">boto3_session</span> <span class="o">=</span> <span class="n">Session</span><span class="p">(</span><span class="n">aws_access_key_id</span><span class="o">=</span><span class="n">AWS_ACCESS_KEY_ID</span><span class="p">,</span>
                        <span class="n">aws_secret_access_key</span><span class="o">=</span><span class="n">AWS_SECRET_ACCESS_KEY</span><span class="p">,</span>
                        <span class="n">region_name</span><span class="o">=</span><span class="n">AWS_REGION_NAME</span><span class="p">)</span>

<span class="n">LOGGING</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;version&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
    <span class="s1">&#39;disable_existing_loggers&#39;</span><span class="p">:</span> <span class="bp">False</span><span class="p">,</span>
    <span class="s1">&#39;root&#39;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s1">&#39;level&#39;</span><span class="p">:</span> <span class="n">logging</span><span class="o">.</span><span class="n">ERROR</span><span class="p">,</span>
        <span class="s1">&#39;handlers&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;console&#39;</span><span class="p">],</span>
    <span class="p">},</span>
    <span class="s1">&#39;formatters&#39;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s1">&#39;simple&#39;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s1">&#39;format&#39;</span><span class="p">:</span> <span class="s2">&quot;</span><span class="si">%(asctime)s</span><span class="s2"> [</span><span class="si">%(levelname)-8s</span><span class="s2">] </span><span class="si">%(message)s</span><span class="s2">&quot;</span><span class="p">,</span>
            <span class="s1">&#39;datefmt&#39;</span><span class="p">:</span> <span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2"> %H:%M:%S&quot;</span>
        <span class="p">},</span>
        <span class="s1">&#39;aws&#39;</span><span class="p">:</span> <span class="p">{</span>
            <span class="c1"># you can add specific format for aws here</span>
            <span class="s1">&#39;format&#39;</span><span class="p">:</span> <span class="s2">&quot;</span><span class="si">%(asctime)s</span><span class="s2"> [</span><span class="si">%(levelname)-8s</span><span class="s2">] </span><span class="si">%(message)s</span><span class="s2">&quot;</span><span class="p">,</span>
            <span class="s1">&#39;datefmt&#39;</span><span class="p">:</span> <span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2"> %H:%M:%S&quot;</span>
        <span class="p">},</span>
    <span class="p">},</span>
    <span class="s1">&#39;handlers&#39;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s1">&#39;watchtower&#39;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s1">&#39;level&#39;</span><span class="p">:</span> <span class="s1">&#39;DEBUG&#39;</span><span class="p">,</span>
            <span class="s1">&#39;class&#39;</span><span class="p">:</span> <span class="s1">&#39;watchtower.CloudWatchLogHandler&#39;</span><span class="p">,</span>
            <span class="s1">&#39;boto3_session&#39;</span><span class="p">:</span> <span class="n">boto3_session</span><span class="p">,</span>
            <span class="s1">&#39;log_group&#39;</span><span class="p">:</span> <span class="s1">&#39;MyLogGroupName&#39;</span><span class="p">,</span>
            <span class="s1">&#39;stream_name&#39;</span><span class="p">:</span> <span class="s1">&#39;MyStreamName&#39;</span><span class="p">,</span>
            <span class="s1">&#39;formatter&#39;</span><span class="p">:</span> <span class="s1">&#39;aws&#39;</span><span class="p">,</span>
        <span class="p">},</span>
    <span class="p">},</span>
    <span class="s1">&#39;loggers&#39;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s1">&#39;django&#39;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s1">&#39;level&#39;</span><span class="p">:</span> <span class="s1">&#39;INFO&#39;</span><span class="p">,</span>
            <span class="s1">&#39;handlers&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;watchtower&#39;</span><span class="p">],</span>
            <span class="s1">&#39;propagate&#39;</span><span class="p">:</span> <span class="bp">False</span><span class="p">,</span>
        <span class="p">},</span>
        <span class="c1"># add your other loggers here...</span>
    <span class="p">},</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Using this configuration, every log statement from Django will be sent to Cloudwatch in the log group <code class="docutils literal notranslate"><span class="pre">MyLogGroupName</span></code>
under the stream name <code class="docutils literal notranslate"><span class="pre">MyStreamName</span></code>. Instead of setting credentials via <code class="docutils literal notranslate"><span class="pre">AWS_ACCESS_KEY_ID</span></code> and other variables,
you can also assign an IAM role to your instance and omit those parameters, prompting boto3 to ingest credentials from
instance metadata.</p>
<p>(See also the <a class="reference external" href="https://docs.djangoproject.com/en/dev/topics/logging/">Django logging documentation</a>).</p>
</div>
<div class="section" id="examples-querying-cloudwatch-logs">
<h2>Examples: Querying CloudWatch logs<a class="headerlink" href="#examples-querying-cloudwatch-logs" title="Permalink to this headline">¶</a></h2>
<p>This section is not specific to Watchtower. It demonstrates the use of awscli and jq to read and search CloudWatch logs
on the command line.</p>
<p>For the Flask example above, you can retrieve your application logs with the following two commands:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">aws</span> <span class="n">logs</span> <span class="n">get</span><span class="o">-</span><span class="n">log</span><span class="o">-</span><span class="n">events</span> <span class="o">--</span><span class="n">log</span><span class="o">-</span><span class="n">group</span><span class="o">-</span><span class="n">name</span> <span class="n">watchtower</span> <span class="o">--</span><span class="n">log</span><span class="o">-</span><span class="n">stream</span><span class="o">-</span><span class="n">name</span> <span class="n">loggable</span> <span class="o">|</span> <span class="n">jq</span> <span class="s1">&#39;.events[].message&#39;</span>
<span class="n">aws</span> <span class="n">logs</span> <span class="n">get</span><span class="o">-</span><span class="n">log</span><span class="o">-</span><span class="n">events</span> <span class="o">--</span><span class="n">log</span><span class="o">-</span><span class="n">group</span><span class="o">-</span><span class="n">name</span> <span class="n">watchtower</span> <span class="o">--</span><span class="n">log</span><span class="o">-</span><span class="n">stream</span><span class="o">-</span><span class="n">name</span> <span class="n">werkzeug</span> <span class="o">|</span> <span class="n">jq</span> <span class="s1">&#39;.events[].message&#39;</span>
</pre></div>
</div>
<p>CloudWatch Logs supports alerting and dashboards based on <a class="reference external" href="http://docs.aws.amazon.com/AmazonCloudWatch/latest/DeveloperGuide/FilterAndPatternSyntax.html">metric filters</a>, which are pattern
rules that extract information from your logs and feed it to alarms and dashboard graphs. The following example shows
logging structured JSON data using Watchtower, setting up a metric filter to extract data from the log stream, a dashboard to
visualize it, and an alarm that sends an email:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">TODO</span>
</pre></div>
</div>
</div>
<div class="section" id="examples-python-logging-config">
<h2>Examples: Python Logging Config<a class="headerlink" href="#examples-python-logging-config" title="Permalink to this headline">¶</a></h2>
<p>Python has the ability to provide a configuration file that can be loaded in order to separate the logging
configuration from the code. Historically, Python has used the <code class="docutils literal notranslate"><span class="pre">logging.config.fileConfig</span></code> function to do
so, however, that feature lacks the ability to use keyword args. Python 2.7 introduced a new feature to
handle logging that is more robust - <code class="docutils literal notranslate"><span class="pre">logging.config.dictConfig</span></code> which provides the ability to do more
advanced Filters, but more importantly adds keyword args, thus allowing the <code class="docutils literal notranslate"><span class="pre">logging.config</span></code> functionality
to instantiate Watchtower.</p>
<p>The following are two example YAML configuration files that can be loaded using <code class="docutils literal notranslate"><span class="pre">PyYaml</span></code>. The resulting
<code class="docutils literal notranslate"><span class="pre">dict</span></code> object can then be loaded into <code class="docutils literal notranslate"><span class="pre">logging.config.dictConfig</span></code>. The first example is a basic example
that relies on the default configuration provided by <code class="docutils literal notranslate"><span class="pre">boto3</span></code>:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="c1"># Default AWS Config</span>
<span class="nt">version</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">1</span>
<span class="nt">formatters</span><span class="p">:</span>
    <span class="nt">json</span><span class="p">:</span>
        <span class="nt">format</span><span class="p">:</span> <span class="s">&quot;[%(asctime)s]</span><span class="nv"> </span><span class="s">%(process)d</span><span class="nv"> </span><span class="s">%(levelname)s</span><span class="nv"> </span><span class="s">%(name)s:%(funcName)s:%(lineno)s</span><span class="nv"> </span><span class="s">-</span><span class="nv"> </span><span class="s">%(message)s&quot;</span>
    <span class="nt">plaintext</span><span class="p">:</span>
        <span class="nt">format</span><span class="p">:</span> <span class="s">&quot;[%(asctime)s]</span><span class="nv"> </span><span class="s">%(process)d</span><span class="nv"> </span><span class="s">%(levelname)s</span><span class="nv"> </span><span class="s">%(name)s:%(funcName)s:%(lineno)s</span><span class="nv"> </span><span class="s">-</span><span class="nv"> </span><span class="s">%(message)s&quot;</span>
<span class="nt">handlers</span><span class="p">:</span>
    <span class="nt">console</span><span class="p">:</span>
        <span class="nt">()</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">logging.StreamHandler</span>
        <span class="nt">level</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">DEBUG</span>
        <span class="nt">formatter</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">plaintext</span>
        <span class="nt">stream</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">sys.stdout</span>
    <span class="nt">watchtower</span><span class="p">:</span>
        <span class="nt">formatter</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">json</span>
        <span class="nt">level</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">DEBUG</span>
        <span class="nt">()</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">watchtower.CloudWatchLogHandler</span>
        <span class="nt">log_group</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">logger</span>
        <span class="nt">stream_name</span><span class="p">:</span>  <span class="l l-Scalar l-Scalar-Plain">loggable</span>
        <span class="nt">send_interval</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">1</span>
        <span class="nt">create_log_group</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">False</span>
<span class="nt">loggers</span><span class="p">:</span>
    <span class="nt">root</span><span class="p">:</span>
        <span class="nt">handlers</span><span class="p">:</span> <span class="p p-Indicator">[</span><span class="nv">console</span><span class="p p-Indicator">,</span> <span class="nv">watchtower</span><span class="p p-Indicator">,</span> <span class="nv">logfile</span><span class="p p-Indicator">]</span>
    <span class="nt">boto</span><span class="p">:</span>
        <span class="nt">handlers</span><span class="p">:</span> <span class="p p-Indicator">[</span><span class="nv">console</span><span class="p p-Indicator">]</span>
    <span class="nt">boto3</span><span class="p">:</span>
        <span class="nt">handlers</span><span class="p">:</span> <span class="p p-Indicator">[</span><span class="nv">console</span><span class="p p-Indicator">]</span>
    <span class="nt">botocore</span><span class="p">:</span>
        <span class="nt">handlers</span><span class="p">:</span> <span class="p p-Indicator">[</span><span class="nv">console</span><span class="p p-Indicator">]</span>
    <span class="nt">requests</span><span class="p">:</span>
        <span class="nt">handlers</span><span class="p">:</span> <span class="p p-Indicator">[</span><span class="nv">console</span><span class="p p-Indicator">]</span>
</pre></div>
</div>
<p>The above works well if you can use the default configuration, or rely on environmental variables.
However, sometimes one may want to use different credentials for logging than used for other functionality;
in this case the <code class="docutils literal notranslate"><span class="pre">boto3_profile_name</span></code> option to Watchtower can be used to provide a profile name:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="c1"># AWS Config Profile</span>
<span class="nt">version</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">1</span>
<span class="nt">formatters</span><span class="p">:</span>
    <span class="nt">json</span><span class="p">:</span>
        <span class="nt">format</span><span class="p">:</span> <span class="s">&quot;[%(asctime)s]</span><span class="nv"> </span><span class="s">%(process)d</span><span class="nv"> </span><span class="s">%(levelname)s</span><span class="nv"> </span><span class="s">%(name)s:%(funcName)s:%(lineno)s</span><span class="nv"> </span><span class="s">-</span><span class="nv"> </span><span class="s">%(message)s&quot;</span>
    <span class="nt">plaintext</span><span class="p">:</span>
        <span class="nt">format</span><span class="p">:</span> <span class="s">&quot;[%(asctime)s]</span><span class="nv"> </span><span class="s">%(process)d</span><span class="nv"> </span><span class="s">%(levelname)s</span><span class="nv"> </span><span class="s">%(name)s:%(funcName)s:%(lineno)s</span><span class="nv"> </span><span class="s">-</span><span class="nv"> </span><span class="s">%(message)s&quot;</span>
<span class="nt">handlers</span><span class="p">:</span>
    <span class="nt">console</span><span class="p">:</span>
        <span class="nt">()</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">logging.StreamHandler</span>
        <span class="nt">level</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">DEBUG</span>
        <span class="nt">formatter</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">plaintext</span>
        <span class="nt">stream</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">sys.stdout</span>
    <span class="nt">watchtower</span><span class="p">:</span>
        <span class="nt">formatter</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">json</span>
        <span class="nt">level</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">DEBUG</span>
        <span class="nt">()</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">watchtower.CloudWatchLogHandler</span>
        <span class="nt">log_group</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">logger</span>
        <span class="nt">stream_name</span><span class="p">:</span>  <span class="l l-Scalar l-Scalar-Plain">loggable</span>
        <span class="nt">boto3_profile_name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">watchtowerlogger</span>
        <span class="nt">send_interval</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">1</span>
        <span class="nt">create_log_group</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">False</span>
<span class="nt">loggers</span><span class="p">:</span>
    <span class="nt">root</span><span class="p">:</span>
        <span class="nt">handlers</span><span class="p">:</span> <span class="p p-Indicator">[</span><span class="nv">console</span><span class="p p-Indicator">,</span> <span class="nv">watchtower</span><span class="p p-Indicator">,</span> <span class="nv">logfile</span><span class="p p-Indicator">]</span>
    <span class="nt">boto</span><span class="p">:</span>
        <span class="nt">handlers</span><span class="p">:</span> <span class="p p-Indicator">[</span><span class="nv">console</span><span class="p p-Indicator">]</span>
    <span class="nt">boto3</span><span class="p">:</span>
        <span class="nt">handlers</span><span class="p">:</span> <span class="p p-Indicator">[</span><span class="nv">console</span><span class="p p-Indicator">]</span>
    <span class="nt">botocore</span><span class="p">:</span>
        <span class="nt">handlers</span><span class="p">:</span> <span class="p p-Indicator">[</span><span class="nv">console</span><span class="p p-Indicator">]</span>
    <span class="nt">requests</span><span class="p">:</span>
        <span class="nt">handlers</span><span class="p">:</span> <span class="p p-Indicator">[</span><span class="nv">console</span><span class="p p-Indicator">]</span>
</pre></div>
</div>
<p>For the more advanced configuration, the following configuration file will provide
the matching credentials to the <code class="docutils literal notranslate"><span class="pre">watchtowerlogger</span></code> profile:</p>
<div class="highlight-cfg notranslate"><div class="highlight"><pre><span></span><span class="k">[profile watchtowerlogger]</span>
<span class="na">aws_access_key_id</span><span class="o">=</span><span class="s">MyAwsAccessKey</span>
<span class="na">aws_secret_access_key</span><span class="o">=</span><span class="s">MyAwsSecretAccessKey</span>
<span class="na">region</span><span class="o">=</span><span class="s">us-east-1</span>
</pre></div>
</div>
<p>Finally, the following shows how to load the configuration into the working application:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">logging.config</span>

<span class="kn">import</span> <span class="nn">flask</span>
<span class="kn">import</span> <span class="nn">yaml</span>

<span class="n">app</span> <span class="o">=</span> <span class="n">flask</span><span class="o">.</span><span class="n">Flask</span><span class="p">(</span><span class="s2">&quot;loggable&quot;</span><span class="p">)</span>

<span class="nd">@app.route</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">hello_world</span><span class="p">():</span>
    <span class="k">return</span> <span class="s1">&#39;Hello World!&#39;</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;logging.yml&#39;</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">log_config</span><span class="p">:</span>
        <span class="n">config_yml</span> <span class="o">=</span> <span class="n">log_config</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
        <span class="n">config_dict</span> <span class="o">=</span> <span class="n">yaml</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">config_yml</span><span class="p">)</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">dictConfig</span><span class="p">(</span><span class="n">config_dict</span><span class="p">)</span>
        <span class="n">app</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
</pre></div>
</div>
<div class="section" id="authors">
<h3>Authors<a class="headerlink" href="#authors" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>Andrey Kislyuk</p></li>
</ul>
</div>
<div class="section" id="links">
<h3>Links<a class="headerlink" href="#links" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p><a class="reference external" href="https://github.com/kislyuk/watchtower">Project home page (GitHub)</a></p></li>
<li><p><a class="reference external" href="https://kislyuk.github.io/watchtower/">Documentation</a></p></li>
<li><p><a class="reference external" href="https://pypi.python.org/pypi/watchtower">Package distribution (PyPI)</a></p></li>
<li><p><a class="reference external" href="https://pypi.python.org/pypi/awscli-cwlogs">AWS CLI CloudWatch Logs plugin</a></p></li>
<li><p><a class="reference external" href="https://github.com/docker/docker/blob/master/daemon/logger/awslogs/cloudwatchlogs.go">Docker awslogs adapter</a></p></li>
</ul>
</div>
</div>
<div class="section" id="bugs">
<h2>Bugs<a class="headerlink" href="#bugs" title="Permalink to this headline">¶</a></h2>
<p>Please report bugs, issues, feature requests, etc. on <a class="reference external" href="https://github.com/kislyuk/watchtower/issues">GitHub</a>.</p>
<div class="section" id="license">
<h3>License<a class="headerlink" href="#license" title="Permalink to this headline">¶</a></h3>
<p>Licensed under the terms of the <a class="reference external" href="http://www.apache.org/licenses/LICENSE-2.0">Apache License, Version 2.0</a>.</p>
<a class="reference external image-reference" href="https://travis-ci.org/kislyuk/watchtower"><img alt="https://travis-ci.org/kislyuk/watchtower.svg" src="https://travis-ci.org/kislyuk/watchtower.svg" /></a>
<a class="reference external image-reference" href="https://codecov.io/github/kislyuk/watchtower?branch=master"><img alt="https://codecov.io/github/kislyuk/watchtower/coverage.svg?branch=master" src="https://codecov.io/github/kislyuk/watchtower/coverage.svg?branch=master" /></a>
<a class="reference external image-reference" href="https://pypi.python.org/pypi/watchtower"><img alt="https://img.shields.io/pypi/v/watchtower.svg" src="https://img.shields.io/pypi/v/watchtower.svg" /></a>
<a class="reference external image-reference" href="https://pypi.python.org/pypi/watchtower"><img alt="https://img.shields.io/pypi/l/watchtower.svg" src="https://img.shields.io/pypi/l/watchtower.svg" /></a>
</div>
</div>
</div>
<div class="section" id="module-watchtower">
<span id="api-documentation"></span><h1>API documentation<a class="headerlink" href="#module-watchtower" title="Permalink to this headline">¶</a></h1>
<dl class="class">
<dt id="watchtower.CloudWatchLogHandler">
<em class="property">class </em><code class="sig-prename descclassname">watchtower.</code><code class="sig-name descname">CloudWatchLogHandler</code><span class="sig-paren">(</span><em class="sig-param">log_group='watchtower'</em>, <em class="sig-param">stream_name=None</em>, <em class="sig-param">use_queues=True</em>, <em class="sig-param">send_interval=60</em>, <em class="sig-param">max_batch_size=1048576</em>, <em class="sig-param">max_batch_count=10000</em>, <em class="sig-param">boto3_session=None</em>, <em class="sig-param">boto3_profile_name=None</em>, <em class="sig-param">create_log_group=True</em>, <em class="sig-param">log_group_retention_days=None</em>, <em class="sig-param">create_log_stream=True</em>, <em class="sig-param">json_serialize_default=None</em>, <em class="sig-param">max_message_size=262144</em>, <em class="sig-param">endpoint_url=None</em>, <em class="sig-param">*args</em>, <em class="sig-param">**kwargs</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/watchtower.html#CloudWatchLogHandler"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#watchtower.CloudWatchLogHandler" title="Permalink to this definition">¶</a></dt>
<dd><p>Create a new CloudWatch log handler object. This is the main entry point to the functionality of the module. See
<a class="reference external" href="http://docs.aws.amazon.com/AmazonCloudWatch/latest/DeveloperGuide/WhatIsCloudWatchLogs.html">http://docs.aws.amazon.com/AmazonCloudWatch/latest/DeveloperGuide/WhatIsCloudWatchLogs.html</a> for more information.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>log_group</strong> (<em>String</em>) – Name of the CloudWatch log group to write logs to. By default, the name of this module is used.</p></li>
<li><p><strong>stream_name</strong> (<em>String</em>) – Name of the CloudWatch log stream to write logs to. By default, the name of the logger that processed the
message is used. Accepts a format string parameter of {logger_name}, as well as {strftime:%m-%d-y}, where
any strftime string can be used to include the current UTC datetime in the stream name.</p></li>
<li><p><strong>use_queues</strong> – If <strong>True</strong>, logs will be queued on a per-stream basis and sent in batches. To manage the queues, a queue
handler thread will be spawned.</p></li>
<li><p><strong>send_interval</strong> (<em>Integer</em>) – Maximum time (in seconds, or a timedelta) to hold messages in queue before sending a batch.</p></li>
<li><p><strong>max_batch_size</strong> (<em>Integer</em>) – Maximum size (in bytes) of the queue before sending a batch. From CloudWatch Logs documentation: <strong>The maximum
batch size is 1,048,576 bytes, and this size is calculated as the sum of all event messages in UTF-8, plus 26
bytes for each log event.</strong></p></li>
<li><p><strong>max_batch_count</strong> (<em>Integer</em>) – Maximum number of messages in the queue before sending a batch. From CloudWatch Logs documentation: <strong>The
maximum number of log events in a batch is 10,000.</strong></p></li>
<li><p><strong>boto3_session</strong> (<em>boto3.session.Session</em>) – Session object to create boto3 <cite>logs</cite> clients. Accepts AWS credential, profile_name, and region_name from its
constructor.</p></li>
<li><p><strong>create_log_group</strong> (<em>Boolean</em>) – Create CloudWatch Logs log group if it does not exist.  <strong>True</strong> by default.</p></li>
<li><p><strong>log_group_retention_days</strong> (<em>Integer</em>) – Sets the retention policy of the log group in days.  <strong>None</strong> by default.</p></li>
<li><p><strong>create_log_stream</strong> (<em>Boolean</em>) – Create CloudWatch Logs log stream if it does not exist.  <strong>True</strong> by default.</p></li>
<li><p><strong>json_serialize_default</strong> (<em>Function</em>) – The ‘default’ function to use when serializing dictionaries as JSON. Refer to the Python standard library
documentation on ‘json’ for more explanation about the ‘default’ parameter.
<a class="reference external" href="https://docs.python.org/3/library/json.html#json.dump">https://docs.python.org/3/library/json.html#json.dump</a>
<a class="reference external" href="https://docs.python.org/2/library/json.html#json.dump">https://docs.python.org/2/library/json.html#json.dump</a></p></li>
<li><p><strong>max_message_size</strong> (<em>Integer</em>) – Maximum size (in bytes) of a single message.</p></li>
<li><p><strong>endpoint_url</strong> (<em>String</em>) – The complete URL to use for the constructed client. Normally, botocore will automatically construct
the appropriate URL to use when communicating with a service. You can specify a complete URL
(including the “http/https” scheme) to override this behavior.</p></li>
</ul>
</dd>
</dl>
<dl class="method">
<dt id="watchtower.CloudWatchLogHandler.close">
<code class="sig-name descname">close</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/watchtower.html#CloudWatchLogHandler.close"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#watchtower.CloudWatchLogHandler.close" title="Permalink to this definition">¶</a></dt>
<dd><p>Tidy up any resources used by the handler.</p>
<p>This version removes the handler from an internal map of handlers,
_handlers, which is used for handler lookup by name. Subclasses
should ensure that this gets called from overridden close()
methods.</p>
</dd></dl>

<dl class="method">
<dt id="watchtower.CloudWatchLogHandler.emit">
<code class="sig-name descname">emit</code><span class="sig-paren">(</span><em class="sig-param">message</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/watchtower.html#CloudWatchLogHandler.emit"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#watchtower.CloudWatchLogHandler.emit" title="Permalink to this definition">¶</a></dt>
<dd><p>Do whatever it takes to actually log the specified logging record.</p>
<p>This version is intended to be implemented by subclasses and so
raises a NotImplementedError.</p>
</dd></dl>

<dl class="method">
<dt id="watchtower.CloudWatchLogHandler.flush">
<code class="sig-name descname">flush</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/watchtower.html#CloudWatchLogHandler.flush"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#watchtower.CloudWatchLogHandler.flush" title="Permalink to this definition">¶</a></dt>
<dd><p>Ensure all logging output has been flushed.</p>
<p>This version does nothing and is intended to be implemented by
subclasses.</p>
</dd></dl>

</dd></dl>

<dl class="exception">
<dt id="watchtower.WatchtowerWarning">
<em class="property">exception </em><code class="sig-prename descclassname">watchtower.</code><code class="sig-name descname">WatchtowerWarning</code><a class="reference internal" href="_modules/watchtower.html#WatchtowerWarning"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#watchtower.WatchtowerWarning" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

</div>
<div class="section" id="table-of-contents">
<h1>Table of Contents<a class="headerlink" href="#table-of-contents" title="Permalink to this headline">¶</a></h1>
<div class="toctree-wrapper compound">
</div>
<ul class="simple">
<li><p><a class="reference internal" href="genindex.html"><span class="std std-ref">Index</span></a></p></li>
<li><p><a class="reference internal" href="py-modindex.html"><span class="std std-ref">Module Index</span></a></p></li>
<li><p><a class="reference internal" href="search.html"><span class="std std-ref">Search Page</span></a></p></li>
</ul>
</div>


          </div>
            
        </div>
        <div class="clearfix"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="#">watchtower  documentation</a> &#187;</li> 
      </ul>
    </div>
<script type="text/javascript">
  $("#mobile-toggle a").click(function () {
    $("#left-column").toggle();
  });
</script>
<script type="text/javascript" src="_static/js/bootstrap.js"></script>
  <div class="footer">
    &copy; Copyright Andrey Kislyuk. Created using <a href="http://sphinx.pocoo.org/">Sphinx</a>.
  </div>
  </body>
</html>